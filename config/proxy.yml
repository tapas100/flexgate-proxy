# FlexGate Proxy Configuration
# Schema Version: 1.0.0
version: "1.0.0"

proxy:
  host: "0.0.0.0"
  port: 3000
  maxBodySize: "10mb"
  trustProxy: false
  cors:
    enabled: true
    origin: "*"
    credentials: false

timeouts:
  request: 30000
  connect: 5000
  idle: 120000

logging:
  level: "info"
  format: "json"
  sampling:
    enabled: false
    successRate: 1.0
    errorRate: 1.0
  redaction:
    enabled: true
    fields:
      - "password"
      - "token"
      - "apiKey"
      - "secret"
      - "authorization"

redis:
  enabled: false
  host: "localhost"
  port: 6379
  password: ""
  db: 0
  keyPrefix: "flexgate:"

upstreams:
  - name: "httpbin"
    url: "https://httpbin.org"
    timeout: 5000
    healthCheck:
      enabled: true
      path: "/status/200"
      interval: 30000
      timeout: 5000
      unhealthyThreshold: 3
      healthyThreshold: 2
    circuitBreaker:
      enabled: true
      failureThreshold: 5
      successThreshold: 2
      timeout: 60000
      halfOpenRequests: 3
  
  - name: "jsonplaceholder"
    url: "https://jsonplaceholder.typicode.com"
    timeout: 5000
    healthCheck:
      enabled: true
      path: "/posts/1"
      interval: 30000
      timeout: 5000
      unhealthyThreshold: 3
      healthyThreshold: 2
    circuitBreaker:
      enabled: true
      failureThreshold: 5
      successThreshold: 2
      timeout: 60000
      halfOpenRequests: 3

routes:
  - path: "/httpbin/*"
    upstream: "httpbin"
    methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
    stripPath: "/httpbin"
    rateLimit:
      enabled: true
      max: 100
      windowMs: 60000
      message: "Too many requests to httpbin"
  
  - path: "/external/api/*"
    upstream: "jsonplaceholder"
    methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "PATCH"
    stripPath: "/external/api"
    rateLimit:
      enabled: true
      max: 200
      windowMs: 60000
      message: "Too many requests to API"

http:
  maxFreeSockets: 10
  timeout: 60000
  keepAlive: true

backpressure:
  enabled: true
  maxQueueSize: 1000
  maxConnections: 5000
  queueTimeout: 5000
